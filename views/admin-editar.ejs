<%- include('partials/admin-header') %>

    <main class="container">
    
        <nav class="admin-nav">
            <a href="/admin/dashboard">Painel de Controlo</a>
            <a href="/admin/novo">Escrever Novo Artigo</a>
            <a href="/logout" class="logout">Sair (Logout)</a>
        </nav>

        <h1>Editar Artigo: <%= article.title %></h1>

        <form action="/admin/salvar-edicao/<%= article.id %>" method="POST" enctype="multipart/form-data">
  
 
             
            <div class="form-group">
                <label for="titulo">Título da Notícia:</label>
                <input type="text" id="titulo" name="title" value="<%= article.title %>" required>
            </div>
            
        
    
     <div class="form-group">
                <label for="autor">Autor:</label>
                <input type="text" id="autor" name="author" value="<%= article.author %>">
            </div>
            
            <div class="form-group">
               
  <label for="category">Categoria:</label>
     
                 <select id="category" name="category" class="form-group-select" required>
                    <% categories.forEach(cat => { %>
                        <option 
                       
      value="<%= cat %>"
      
                           <%= (cat === article.category) ?
 'selected' : '' %>
                        >
                            <%= cat %>
                        </option>
                   
 
     <% }) %>
                </select>
            </div>

            <div class="form-group">
                <label>Imagem de Destaque Atual:</label>
                <input type="hidden" name="old_image_url" value="<%= article.image_url %>">
            
     
 
                <% if (article.image_url) { %>
                    <img src="<%= article.image_url %>" alt="Imagem atual" class="current-image-preview">
                <% } else { %>
                    <p style="font-size: 0.9em; color: #777;">Este artigo não tem imagem 
 de destaque.</p>
    
                 <% } %>
            </div>

            <div class="form-group">
                <label for="image">Substituir Imagem (Opcional):</label>
                <p style="font-size: 0.9em; color: #777;">Deixe em branco para manter a imagem atual.</p>
     
           
     <input type="file" id="image" name="image" class="form-group-file" accept="image/*">
            </div>
            
            <div class="form-group">
                <label for="conteudo">Conteúdo Completo da Notícia:</label>
                <textarea id="conteudo" name="content" required><%= article.content %></textarea>
  
           </div>
    
             
            <button type="submit" class="submit-button green">Salvar Alterações</button>
            
        </form>

    </main>

<script>
  // Espera o HTML da página carregar completamente antes de iniciar o TinyMCE
  document.addEventListener('DOMContentLoaded', (event) => {
    tinymce.init({
      selector: 'textarea#conteudo',
   
    plugins: 'lists link image media table code help wordcount autoresize',
      
      // CORREÇÃO FEITA AQUI: A string 'toolbar' está agora numa única linha
      toolbar: 'undo redo | blocks | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | removeformat | help',
      
      height: 500,
      menubar: false,
    });
  });
 </script>

<%- include('partials/admin-footer') %>